# 数据库同步工具

这个工具用于在开发环境和生产环境之间同步数据库结构和数据。

## 功能

1. 将开发环境的表结构同步到生产环境（开发环境数据库表有变更）
2. 将生产环境的特定表数据（chapters, knowledge_points）同步到开发环境（生产环境数据更多更全）

## 使用方法

### 前提条件

- 安装了 PostgreSQL 客户端工具（psql, pg_dump, pg_restore）
- 对两个数据库有足够的访问权限

### 开始同步

运行安全同步脚本（推荐）：

```bash
./db_sync/run_safe_sync.sh
```

这将会：
1. 在开始同步前备份两个数据库
2. 然后执行同步流程

如果你不需要备份，可以直接运行：

```bash
./db_sync/run_sync.sh
```

### 单独执行各步骤

如果需要单独执行某一步骤，可以使用以下脚本：

- 备份数据库：`./db_sync/backup_databases.sh`
- 导出开发环境表结构：`./db_sync/export_dev_schema.sh`
- 将表结构导入生产环境：`./db_sync/import_schema_to_prod.sh`
- 导出生产环境特定表数据：`./db_sync/export_prod_data.sh`
- 将特定表数据导入开发环境：`./db_sync/import_data_to_dev.sh`

## 注意事项

- 同步过程会修改两个数据库的数据，请确保你明确知道这一操作的影响
- 备份文件保存在 `db_sync/backups/` 目录中，格式为 `{env}_db_backup_{timestamp}.dump`
- 在导入生产环境数据到开发环境前，会先清空开发环境中的相应表数据，避免冲突

## 故障排除

如果遇到连接问题，请检查：
- 数据库连接信息是否正确
- 防火墙设置是否允许连接
- 数据库用户是否有足够的权限

如果遇到导入/导出失败，请检查：
- 备份文件是否存在
- 日志中的错误信息
- 磁盘空间是否足够 