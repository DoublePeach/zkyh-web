#!/bin/bash

echo "==============================================="
echo "安全数据库同步工具 - 开始同步过程"
echo "==============================================="
echo "0. 创建数据库备份"
echo "1. 将开发环境表结构同步到生产环境"
echo "2. 将生产环境特定表数据同步到开发环境"
echo "==============================================="

# 确认操作
read -p "这个操作会修改两个数据库中的数据，确定要继续吗? (y/n) " answer
if [ "$answer" != "y" ]; then
  echo "操作已取消"
  exit 0
fi

# 加载数据库配置
source ./db_sync/db_config.sh

echo "==============================================="
echo "步骤 0: 创建两个数据库的备份"
echo "==============================================="
./db_sync/backup_databases.sh

# 在继续之前再次确认
read -p "备份已完成，要继续同步过程吗? (y/n) " answer
if [ "$answer" != "y" ]; then
  echo "操作已取消"
  exit 0
fi

echo "==============================================="
echo "执行同步流程..."
echo "==============================================="
./db_sync/run_sync.sh

echo "==============================================="
echo "安全同步完成! 👍"
echo "在开始同步前，已创建了数据库备份。"
echo "备份文件保存在: db_sync/backups/ 目录"
echo "===============================================" 